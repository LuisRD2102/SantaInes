@model Tuple<SantaInesWEB.Models.UsuarioModel,SantaInesWEB.Models.DireccionModel>

<head>
    <link rel="stylesheet" href="~/css/Configuracion.css"/>
    <link rel="stylesheet" href="~/css/Modal.css" /> 
</head>

@section scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.11/jquery.validate.unobtrusive.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.10/jquery.mask.js"></script>

    <script>
        $(document).ready(function () {
            var settedValues = false;
            //Rellena el dropdown de estados
            var dropDown = $("#estadosDDL");
            $.ajax({
                type: "GET",
                url: 'https://localhost:7270/Direccion/ConsultarEstados',
                data: "",
                success: function (result) {
                    var data = result.data;
                    var s = '<option value="">Estado</option>';
                    for (var i = 0; i < data.length; i++) {
                        s += '<option value="' + data[i].id_estado + '">' + data[i].estado + '</option>';
                    }
                    dropDown.html(s);
                    dropDown.prop('disabled', false);
                    if (settedValues == false)
                        dropDown.val(@Model.Item2.id_estado).trigger('change');
                }
            });

            //Rellena el dropdown de municipios segun el estado que se seleccione
            $("#estadosDDL").change(function () {
                var dropDown = $("#municipiosDDL");
                dropDown.prop('disabled', true);
                $("#parroquiasDDL").prop('disabled', true);
                $("#municipiosDDL option:not(:first)").remove();
                $("#parroquiasDDL option:not(:first)").remove();
                var id_estado = $("#estadosDDL").val();

                if (id_estado)
                    $.ajax({
                        type: "GET",
                        url: 'https://localhost:7270/Direccion/ConsultarMunicipios/' + id_estado,
                        data: "",
                        success: function (result) {
                            var data = result.data;
                            var s = '<option value="">Municipio</option>';
                            for (var i = 0; i < data.length; i++) {
                                s += '<option value="' + data[i].id_municipio + '">' + data[i].municipio + '</option>';
                            }
                            dropDown.html(s);
                            dropDown.prop('disabled', false);
                            if (settedValues == false)
                                dropDown.val(@Model.Item2.id_municipio).trigger('change');
                        }
                    });
            });

            //Rellena el dropdown de parroquias segun el municipio que se seleccione
            $("#municipiosDDL").change(function () {
                var dropDown = $("#parroquiasDDL");
                dropDown.prop('disabled', true);
                $("#parroquiasDDL option:not(:first)").remove();
                var id_municipio = $("#municipiosDDL").val();

                if (id_municipio)
                    $.ajax({
                        type: "GET",
                        url: 'https://localhost:7270/Direccion/ConsultarParroquias/' + id_municipio,
                        data: "",
                        success: function (result) {
                            var data = result.data;
                            var s = '<option value="">Parroquia</option>';
                            for (var i = 0; i < data.length; i++) {
                                s += '<option value="' + data[i].id_parroquia + '">' + data[i].parroquia + '</option>';
                            }
                            dropDown.html(s);
                            dropDown.prop('disabled', false);
                            if (settedValues == false){
                                dropDown.val(@Model.Item2.id_parroquia).trigger('change');
                                settedValues = true;
                            }
                        }
                    });
            });

        });


        $(function () {
            $("#telefono").mask("(999) 999-9999");
            $("#cedula").mask("99999999");
        });

    </script>
}

<div class="top-bar">
    <div class="titulo-top">
        <h2>Configuración del perfil</h2>
    </div>
</div>

<div class="contenedor">

    @using (Html.BeginForm("ModificarUsuario", "Configuracion", FormMethod.Post))
    {
        <div class="modal-body">

            @*Usuario*@

            @Html.TextBoxFor(m => m.Item1.cedula, new { @Value = Model.Item1.cedula, @type="hidden", id="cedula"})
            @Html.TextBoxFor(m => m.Item1.sexo, new { @Value = Model.Item1.sexo, @type="hidden"})
            @Html.TextBoxFor(m => m.Item1.username, new { @Value = Model.Item1.username, @type="hidden"})
            @Html.TextBoxFor(m => m.Item1.id_direccion, new { @Value = Model.Item1.id_direccion, @type="hidden"})
            @Html.TextBoxFor(m => m.Item1.fecha_Nacimiento, new { @Value = Model.Item1.fecha_Nacimiento, @type="hidden"})
            @Html.TextBoxFor(m => m.Item1.password, new { @Value = Model.Item1.password, @type="hidden"})
            @Html.TextBoxFor(m => m.Item1.idHistoria, new { @Value = Model.Item1.idHistoria, @type="hidden"})
       

            <div class="flex">
                <div class="in-flex" >
                    <span style="margin-top:15px" class="span">Nombre completo: </span>
                    @Html.TextBoxFor(m => m.Item1.nombre_Completo, new {@Value = Model.Item1.nombre_Completo,Class="form-control", placeholder="Nombre(s): "})
                </div>

                <div class="in-flex">
                    <span style="margin-top:15px" class="span">Estado: </span>
                    @Html.DropDownListFor(d => d.Item2.id_estado, new List<SelectListItem>(),"Estado",new { id = "estadosDDL", Class="form-select",disabled="true" })
                    @Html.ValidationMessageFor(m => m.Item2.id_estado ,null, new { @class = "text-danger-right" })
                </div>
            </div>            
           
            <div class="flex">
                <div class="in-flex">
                    <span style="margin-top:15px" class="span">Apellido completo: </span>
                    @Html.TextBoxFor(m => m.Item1.apellido_Completo, new {@Value = Model.Item1.apellido_Completo,Class="form-control", placeholder="Apellido(s): "})
                </div>
                <div class="in-flex">
                    <span style="margin-top:15px" class="span">Municipio: </span>
                    @Html.DropDownListFor(d => d.Item2.id_municipio, new List<SelectListItem>(),"Municipio",new { id = "municipiosDDL", Class="form-select",disabled="true" })
                    @Html.ValidationMessageFor(m => m.Item2.id_municipio ,null, new { @class = "text-danger-right" })
                </div>
            </div>
            @*Direccion*@

            @Html.TextBoxFor(m => m.Item2.id, new { @Value = Model.Item2.id, @type="hidden"})

            <div class="flex">
                <div class="in-flex">
                    <span style="margin-top:15px" class="span">Teléfono: </span>
                    @Html.TextBoxFor(m => m.Item1.telefono, new {@Value = Model.Item1.telefono,Class="form-control", placeholder="Teléfono: ", id = "telefono"})
                </div>

                <div class="in-flex">
                    <span style="margin-top:15px" class="span">Parroquia: </span>
                    @Html.DropDownListFor(d => d.Item2.id_parroquia, new List<SelectListItem>(),"Parroquia",new { id = "parroquiasDDL", Class="form-select",disabled="true" })
                    @Html.ValidationMessageFor(m => m.Item2.id_parroquia ,null, new { @class = "text-danger-right" })
                </div>
            </div>

            <div class="flex">
                <div class="in-flex">
                    <span style="margin-top:15px" class="span">Correo electrónico: </span>
                    @Html.TextBoxFor(m => m.Item1.email, new {@Value = Model.Item1.email, Class="form-control", placeholder="Correo Electrónico: "})
                </div>
                <div class="in-flex">
                    <span style="margin-top:15px" class="span">Dirección: </span>
                    @Html.TextAreaFor(m => m.Item2.direccion, new {@Value = Model.Item2.direccion,Class="form-control", placeholder="Dirección: "})
                </div>
            </div>

        </div>
        <div class="modal-footer">
            <button type="submit" class="botonCancelar" formaction="@Url.Action("GestionCitas", "Citas")">Cancelar</button>
            <button type="submit" class="botonCrear">Guardar Cambios</button>
        </div>
    }

</div>